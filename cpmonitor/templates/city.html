{% extends "city-base.html" %}
{% load martortags %}
{% load static %}
{% block text-content %}
  <div class="row">
    <div class="col">
      <h1>Monitoring für {{ city.name }}</h1>
    </div>
    <div class="col-auto">
      {% if local_group %}
        <span class="align-middle">von <a href="{% url 'local_group' city.slug %}">{{ local_group.name }}</a></span>
      {% endif %}
    </div>
  </div>
  {% if city.teaser %}<p class="lz-teaser">{{ city.teaser }}</p>{% endif %}
  <p class="lz-description">{{ city.description | safe_markdown }}</p>
{% endblock text-content %}
{% block cards %}
  <div class="row row-deck row-cards">
    {% if days_gone >= 0 %}
      <div class="col-sm-6 col-lg-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="subheader">Restzeit</div>
            </div>
            <div class="h1 mb-3">{{ days_left_proportion }}%</div>
            <div class="d-flex mb-2">
              <div>
                {% if days_left < 365 %}
                  Noch {{ days_left }} Tage
                {% else %}
                  Noch {{ years_left }} Jahre und {{ days_in_year_left }} Tage
                {% endif %}
              </div>
              <div class="ms-auto"></div>
            </div>
            <div class="progress" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" aria-label="{{ days_gone }} Tage seit Beschluss,{{ days_left }} Tage bis zum Zieljahr" title="{{ days_gone }} Tage seit Beschluss
              <br>
              {{ days_left }} Tage bis zum Zieljahr">
              <div class="progress-bar neutral"
                   role="progressbar"
                   data-value="{{ days_gone_proportion }}"
                   aria-valuenow="{{ days_gone_proportion }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    {% if city.subtasks_count %}
      <div class="col-sm-6 col-lg-3">
        <a href="{% url 'task' city.slug %}"
           class="card card-link card-link-popup">
          <div class="card-body ">
            <div class="d-flex align-items-center">
              <div class="subheader">Maßnahmen offen</div>
            </div>
            <div class="h1 mb-3">{{ city.incomplete_proportion }}%</div>
            <div class="d-flex mb-2">
              <div>{{ city.subtasks_count }} Maßnahmen insgesamt</div>
            </div>
            <div class="progress progress-lg progress-separated">
              {% for value, status in city.status_proportions %}
                <div class="progress-bar lz-status {{ status.name }}"
                     role="progressbar"
                     data-bs-toggle="tooltip"
                     data-bs-placement="top"
                     data-value="{{ value }}"
                     title="{{ value }}% {{ status.label }}"
                     aria-label="{{ status.label }}">
                </div>
              {% endfor %}
            </div>
          </div>
          <div class="lz-card-details">
            <svg width="20" height="20">
              <use href="{% static 'tabler-icons/tabler-sprite.svg' %}#tabler-plus"/>
            </svg>
          </div>
        </a>
      </div>
    {% endif %}
    {% if cap_checklist_exists %}
      <div class="col-sm-6 col-lg-3">
        <a href="{% url 'cap_checklist' city.slug %}"
           class="card card-link card-link-popup">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="subheader">Klimaaktionsplan</div>
            </div>
            <div class="h1 mb-3">{{ cap_checklist_number_fulfilled }}/{{ cap_checklist_total }}</div>
            <div class="d-flex mb-2">
              <div>Qualitätskriterien erfüllt</div>
              <div class="ms-auto"></div>
            </div>
            <div class="progress">
              <div class="progress-bar neutral"
                   role="progressbar"
                   data-value="{{ cap_checklist_proportion_fulfilled }}"
                   aria-valuenow="{{ cap_checklist_proportion_fulfilled }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
            </div>
          </div>
          <div class="lz-card-details">
            <svg width="20" height="20">
              <use href="{% static 'tabler-icons/tabler-sprite.svg' %}#tabler-plus"/>
            </svg>
          </div>
        </a>
      </div>
    {% endif %}
    {% if administration_checklist_exists %}
      <div class="col-sm-6 col-lg-3">
        <a href="{% url 'administration_checklist' city.slug %}"
           class="card card-link card-link-popup">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="subheader">Verwaltungsstrukturen</div>
            </div>
            <div class="h1 mb-3">{{ administration_checklist_number_fulfilled }}/{{ administration_checklist_total }}</div>
            <div class="d-flex mb-2">
              <div>Qualitätskriterien erfüllt</div>
              <div class="ms-auto"></div>
            </div>
            <div class="progress">
              <div class="progress-bar neutral"
                   role="progressbar"
                   data-value="{{ administration_checklist_proportion_fulfilled }}"
                   aria-valuenow="{{ administration_checklist_proportion_fulfilled }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
            </div>
          </div>
          <div class="lz-card-details">
            <svg width="20" height="20">
              <use href="{% static 'tabler-icons/tabler-sprite.svg' %}#tabler-plus"/>
            </svg>
          </div>
        </a>
      </div>
    {% endif %}
    {% if energy_plan_checklist_exists %}
      <div class="col-sm-6 col-lg-3">
        <a href="{% url 'energy_plan_checklist' city.slug %}"
           class="card card-link card-link-popup">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="subheader">Wärmeplanung</div>
            </div>
            <div class="h1 mb-3">{{ energy_plan_checklist_number_fulfilled }}/{{ energy_plan_checklist_total }}</div>
            <div class="d-flex mb-2">
              <div>Qualitätskriterien erfüllt</div>
              <div class="ms-auto"></div>
            </div>
            <div class="progress">
              <div class="progress-bar neutral"
                   role="progressbar"
                   data-value="{{ energy_plan_checklist_proportion_fulfilled }}"
                   aria-valuenow="{{ energy_plan_checklist_proportion_fulfilled }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
            </div>
          </div>
          <div class="lz-card-details">
            <svg width="20" height="20">
              <use href="{% static 'tabler-icons/tabler-sprite.svg' %}#tabler-plus"/>
            </svg>
          </div>
        </a>
      </div>
    {% endif %}
  </div>
  {% if tasks %}
    <div class="row row-deck row-cards">
      {% for task in tasks %}
        <div class="col-sm-12 col-lg-6">
          {% include "snippets/taskcard.html" %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  {% if city.show_roof_pv_indicator and city.municipality_key %}
    <div class="row row-deck row-cards">
      <div class="col-sm-12 col-lg-6">
        <div class="card lz-chart" id="kpiPV">
          <div class="card-body">
            <div class="h3 mb-3">Entwicklung Dach-Photovoltaik</div>
            <div class="canvas">Lade...</div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      window.LZM = window.LZM || {};
      LZM.city = {
        municipalityKey: "{{ city.municipality_key }}",
        resolutionYear: {{ city.resolution_date.year }}
      }
    </script>
    <script src="{% static 'js/mstr.js' %}"></script>
  {% endif %}
  {% if charts %}
    <div class="row row-deck row-cards">
      {% for chart in charts %}
        <div class="col-sm-12 col-lg-6">
          <div class="card">
            <div class="card-body">
              <figure class="lz-chart">
                <img class="d-block w-100 border"
                     height="0"
                     width="100%"
                     alt="{{ chart.alt_description }}"
                     src="{{ chart.image.url }}"/>
                <figcaption>
                  {{ chart.caption | safe_markdown }}
                  <span class="text-muted">Quelle: {{ chart.source }} - Lizenz: {{ chart.license }}</span>
                </figcaption>
              </figure>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock cards %}
{% block more-text-content %}
  {% if city.supporting_ngos %}
    <h2>
      Mit Unterstützung von
    </h2>
    {{ city.supporting_ngos | safe_markdown }}
  {% endif %}
{% endblock more-text-content %}
